=========================================================== HOMEWORK Docker-3 =================================
Основное ДЗ*
- Подключились к докер - хосту в облаке;
- Скачали в репозиторий архив с микросервисами;
- Создали докер - файл для каждого микросервиса;
- На основе этих докер - файлов создали образы контейнеров на удаленном хосте;
- Скачали свежий образ БД Монго;
- Создали сеть для приложения и запустили 4 контейнера на удаленном хосте;
- Проверили запуск и работу приложения, пройдя по ссылке 'ip-адрес удаленной машины:9292';

Задание с *

- Остановили все контейнеры;
- Чтобы запустить контейнеры с новыми алиасами без пересоздания образов, попробуем переопределить
  переменные окружения, изначально заданные в докер - файле:
  $docker run -d --network=reddit --network-alias=post_db11 --network-alias=comment_db11 mongo:latest
  $docker run -d --network=reddit -e POST_DATABASE_HOST='post_db11' --network-alias=post11 otusdevops77/post:1.0
  $docker run -d --network=reddit -e COMMENT_DATABASE_HOST='comment-db11' --network-alias=comment11 otusdevops77/   comment:1.0
  $docker run -d --network=reddit -p 9292:9292 -e COMMENT_SERVICE_HOST='comment11' -e POST_SERVICE_HOST='post11' o  tusdevops77/ui:1.0
- Проверили, что приложение запускается, посты добавляются. Значит переопределение алиасов работает;

Основное ДЗ

- Образы с микросервисами занимают много места, измени докер - файл для образа ui;
- Пересобрали образ ui версии 2.0 и убедились, что теперь он занимает 453Мб, а не 781Мб;

Задание со *

- Создали образ ui с помощью Alpine Linux. Инструкции по созданию добавили в Dockerfile.1;
- После создания файл образа уменьшился до 216Мб;
- Попробуем уменьшить размер образа:
  1. Создадим докер файл Dockerfile.2;
  2. Уменьшим количество слоев, объединив директивы RUN для установки пакетов;
  3. Почистим кэш apk;
  В результате полученный образ весит уже 214Мб, а не 216. Помогло, но не сильно.
- Прогнали Dockerfile.2 через линтер fromlatest.io. Линтер посоветовал использовать
  команду RUN apk --no-cache при добавлени пакетов. Пересоздали образ, но размер остался
  тем же.
- Удалили все лишние пакеты из докер-файла. Создали Dockerfile.3. После сборки размер образа
  получился 211Мб.

Основное ДЗ

- Пересоздали все контейнеры и оказалось, что изменения в бд не были сохранены;
- Создали docker volume reddit_db и подключили к контейнеру mongoDB;
- Пересоздали контейнеры, написали пост;
- Удалили и пересоздали контейнеры. Убедились, что пост на месте.




=========================================================== HOMEWORK Docker-2 ==============================================================================

- Создали новый проект docker в GCP;
- Добавили новый проект в GCP SDK на рабочей машине;
- Установили Docker - machine в облаке;
- Подключились по SSH к докер - хосту в облаке. Запустили несколько контейнеров и проверили
  изоляцию процессов и сети; 
- Если запускать контейнер с флагом docker run --rm --pid host, то в этом случае изоляция PID будет неполная и команда htop
  покажет все процессы хост - машины. Скорее всего подобный режим может использоваться при отладке в случае проблем с контейнером;
- Создали структуру репозитория и заполнили скрипты;
- Создали докер - образ на основе описания в созданном Dockerfile;
- Запустили контейнер реддит, но оказалось, что в ДЗ просят сделать это на удаленном хосте в GCE;
- Передали файлы конфигурации на удаленный хост и пересобрали образ там;
- Запустили контейнер на удаленном докер - хосте и убедились, что приложение доступно на порту 9292,
  открыв перед этим порт 9292 в файрволле GCP;
- Создали учетную запись в Докер хаб и авторизовались в командной строке;
- Сделали пуш образа reddit в докер - хаб;
- Скачали и запустили образ reddit из хаба на локальной машине и убедились что приложение работает
  посредством команды localhost:9292;
- Посмотрели логи контейнера, поработали с процессами, остановили, удалили и пересоздали контейнер; 



=========================================================== HOMEWORK Docker-1 ==============================================================================


-  Настроили интеграцию с чатом
-  Установили Докер из репозитория;
-  Запустили контейнеры из шаблонов, скачанных из докер - хаба;
-  Потестировали запуск контейнера, снятие образов;
-  Поработали с командами docker create, docker start, docker run;
-  Посмотрели, как отобразить список образов и список запущенных контейнеров;



ДЗ*

Основные отличия образа от контейнера заключаются в том, что образ - это шаблон в режиме "только чтение". При запуске команды Docker inspect видно, что шабл
он не содержит дополнительных аттрибутов, которые есть у запущенного контейнера.
На основании этого образа - шаблона создается и запускается один или несколько контейнеров. При создании контейнера Docker engine берет образ (файловую систему и метаданые) и запускает контейнер с различными параметрами, такими как сеть, имя контейнера, ресурсы, id, а также с возможностью записи в специальный слой.


# ilya-adm77_microservices
ilya-adm77 microservices repository
